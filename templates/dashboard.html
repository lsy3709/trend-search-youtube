<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íŠ¸ë Œë“œ í‚¤ì›Œë“œ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>íŠ¸ë Œë“œ í‚¤ì›Œë“œ ëŒ€ì‹œë³´ë“œ</h1>
    
    <!-- ì‹¤ì‹œê°„ ì¸ê¸° ê²€ìƒ‰ì–´ ì„¹ì…˜ -->
    <div class="trending-section">
        <h2>ğŸ”¥ ì‹¤ì‹œê°„ ì¸ê¸° ê²€ìƒ‰ì–´</h2>
        <div id="trending-keywords" class="trending-keywords">
            <p>ë¡œë”© ì¤‘...</p>
        </div>
        <button onclick="loadTrendingKeywords()" class="refresh-btn">ìƒˆë¡œê³ ì¹¨</button>
    </div>
    
    <!-- í‚¤ì›Œë“œ ì…ë ¥ í¼ -->
    <div class="search-section">
        <h2>ğŸ” í‚¤ì›Œë“œ ê²€ìƒ‰</h2>
        <form method="get" action="/web">
            <input type="text" name="keyword" value="{{ keyword }}" placeholder="í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
            <button type="submit">ê²€ìƒ‰</button>
        </form>
    </div>
    
    {% if error %}
        <div class="error">ì—ëŸ¬: {{ error }}</div>
    {% endif %}
    
    {% if keyword %}
    <div class="results-section">
        <h2>í‚¤ì›Œë“œ: <span style="color:blue">{{ keyword }}</span></h2>
        <h3>ì´ ê²€ìƒ‰ëŸ‰(ì¡°íšŒìˆ˜ í•©): {{ '{:,}'.format(total_views) }}</h3>
        
        <h3>ìƒìœ„ 10ê°œ íŠ¸ë Œë“œ(ì¡°íšŒìˆ˜ ê¸°ì¤€)</h3>
        <canvas id="trendChart" width="600" height="300"></canvas>
        <script>
            // ìƒìœ„ 10ê°œ íŠ¸ë Œë“œ ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„
            const labels = {{ top_trends | map(attribute='title') | list | tojson }};
            const data = {{ top_trends | map(attribute='view_count') | list | tojson }};
            new Chart(document.getElementById('trendChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì¡°íšŒìˆ˜',
                        data: data,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true } }
                }
            });
        </script>
        
        <h3>íŠ¸ë Œë“œ ë™ì˜ìƒ 100ê°œ</h3>
        <table>
            <thead>
                <tr>
                    <th>ì¸ë„¤ì¼</th>
                    <th>ì œëª©</th>
                    <th>ì‘ì„±ì</th>
                    <th>ì¡°íšŒìˆ˜</th>
                    <th>ì¢‹ì•„ìš”</th>
                    <th>ê²Œì‹œì¼</th>
                </tr>
            </thead>
            <tbody>
            {% for t in trends %}
                <tr>
                    <td>{% if t.thumbnail_url %}<img src="{{ t.thumbnail_url }}" width="80">{% endif %}</td>
                    <td><a href="{{ t.url }}" target="_blank">{{ t.title }}</a></td>
                    <td>{{ t.author }}</td>
                    <td>{{ '{:,}'.format(t.view_count or 0) }}</td>
                    <td>{{ '{:,}'.format(t.like_count or 0) }}</td>
                    <td>{{ t.published_at.strftime('%Y-%m-%d') if t.published_at else '' }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤ì‹œê°„ ì¸ê¸° ê²€ìƒ‰ì–´ ë¡œë“œ
        window.onload = function() {
            loadTrendingKeywords();
        };
        
        // ì‹¤ì‹œê°„ ì¸ê¸° ê²€ìƒ‰ì–´ ë¡œë“œ í•¨ìˆ˜
        async function loadTrendingKeywords() {
            try {
                const response = await fetch('/api/trends/keywords?max_results=20');
                const data = await response.json();
                
                const container = document.getElementById('trending-keywords');
                container.innerHTML = '';
                
                data.trending_keywords.forEach((item, index) => {
                    const keywordDiv = document.createElement('div');
                    keywordDiv.className = 'keyword-item';
                    keywordDiv.innerHTML = `
                        <span class="rank">${index + 1}</span>
                        <span class="keyword">${item.keyword}</span>
                        <span class="score">ğŸ”¥ ${item.trending_score}</span>
                        <span class="platforms">${item.platforms.join(', ')}</span>
                        <span class="views">ğŸ‘ï¸ ${(item.total_views / 1000).toFixed(0)}K</span>
                    `;
                    container.appendChild(keywordDiv);
                });
                
                // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
                const updateTime = document.createElement('div');
                updateTime.className = 'update-time';
                updateTime.innerHTML = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString()}`;
                container.appendChild(updateTime);
                
            } catch (error) {
                console.error('ì¸ê¸° ê²€ìƒ‰ì–´ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('trending-keywords').innerHTML = 
                    '<p class="error">ì¸ê¸° ê²€ìƒ‰ì–´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        // 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setInterval(loadTrendingKeywords, 5 * 60 * 1000);
    </script>
</body>
</html> 